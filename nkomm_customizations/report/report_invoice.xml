<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="report_invoice_document" inherit_id="account.report_invoice_document">
            <xpath expr="//div[hasclass('page')]" position="before">
                <style>
                    .din_page.invoice_note .page tr td{
                    vertical-align: top;
                    }
                </style>
            </xpath>

            <xpath expr="//th[@name='th_subtotal']/span[@groups='account.group_show_line_subtotals_tax_excluded']"
                   position="replace">
                <span groups="account.group_show_line_subtotals_tax_excluded">Gesamt</span>
            </xpath>

            <xpath expr="//th[@name='th_description']" position="before">
                <th name="th_pos" class="text-left">
                    <span>Pos.</span>
                </th>
            </xpath>

            <xpath expr="//td[@name='account_invoice_line_name']" position="replace">
                <td name="account_invoice_line_name">
                    <t t-if="'!!' in line.name">
                        <t t-set="product_name" t-value="line.name.split('!!')[0]"/>
                        <t t-set="product_desc" t-value="line.name.split('!!')[1]"/>
                        <span class="font-weight-bold" t-esc="product_name" t-options='{"widget": "html"}'/>
                        <br/>
                        <span t-esc="product_desc" t-options='{"widget": "html"}'/>
                    </t>
                    <t t-else="">
                        <span t-field="line.name" t-options="{'widget': 'html'}"/>
                    </t>
                </td>
            </xpath>

            <xpath expr="//t[@t-foreach='lines']/tr/t[2]/td/span" position="attributes">
                <attribute name="t-options">{"widget": "html"}</attribute>
            </xpath>

            <xpath expr="//t[@t-foreach='lines']/tr/t[3]/td/span" position="attributes">
                <attribute name="t-options">{"widget": "html"}</attribute>
            </xpath>

            <xpath expr="//span[@t-field='line.product_uom_id']" position="replace"/>

            <xpath expr="//t[@t-foreach='lines']" position="before">
                <t t-set="line_count" t-value="1"/>
            </xpath>

            <xpath expr="//td[@name='account_invoice_line_name']" position="before">
                <td name="td_pos">
                    <span t-esc="line_count"/>
                </td>
            </xpath>

            <xpath expr="//t[@name='account_invoice_line_accountable']" position="inside">
                <t t-set="line_count" t-value="line_count + 1"/>
            </xpath>

            <xpath expr="//span[@id='line_tax_ids']" position="replace">
                <span t-esc="', '.join(map(lambda x: (str(x.amount)+'%'), line.tax_ids))" id="line_tax_ids"/>
            </xpath>

            <xpath expr="//p[@name='payment_communication']" position="attributes">
                <attribute name="class">mt-4</attribute>
            </xpath>

            <xpath expr="//div[@name='comment']" position="replace"/>

        </template>
    </data>
</odoo>