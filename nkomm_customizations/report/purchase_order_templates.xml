<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_purchaseorder_document" inherit_id="purchase.report_purchaseorder_document">

        <xpath expr="//div[hasclass('page')]" position="before">
            <style>
                .din_page.invoice_note .page tr td{
                vertical-align: top;
                }
            </style>
        </xpath>
        <xpath expr="//div[@t-field='o.partner_id']" position="attributes">
            <attribute name="t-options">{"widget": "contact", "fields": ["address", "name"], "no_marker": True}</attribute>
        </xpath>
        <xpath expr="//div[@t-field='o.dest_address_id']" position="attributes">
            <attribute name="t-options">{"widget": "contact", "fields": ["address", "name"], "no_marker": True}</attribute>
        </xpath>

        <xpath expr="//th[@name='th_amount']/strong" position="replace">
            <strong>Gesamt</strong>
        </xpath>

        <xpath expr="//th[@name='th_description']" position="before">
            <th name="th_pos" class="text-left">
                <strong>Pos.</strong>
            </th>
        </xpath>

        <xpath expr="//td[@id='product']" position="replace">
            <td id="product">
                <t t-if="'!!' in line.name">
                    <t t-set="product_name" t-value="line.name.split('!!')[0]"/>
                    <t t-set="product_desc" t-value="line.name.split('!!')[1]"/>
                    <span class="font-weight-bold" t-esc="product_name"/>
                    <br/>
                    <span t-esc="product_desc"/>
                </t>
                <t t-else="">
                    <span t-field="line.name"/>
                </t>
            </td>
        </xpath>

        <xpath expr="//t[@t-foreach='o.order_line']" position="before">
            <t t-set="line_count" t-value="1"/>
        </xpath>

        <xpath expr="//span[@t-field='line.product_uom.name']" position="replace"/>

        <xpath expr="//td[@id='product']" position="before">
            <td name="td_pos">
                <span t-esc="line_count"/>
            </td>
        </xpath>

        <xpath expr="//t[@t-if='not line.display_type']" position="inside">
            <t t-set="line_count" t-value="line_count + 1"/>
        </xpath>

        <xpath expr="//td[@name='td_taxes']" position="replace">
            <td name="td_taxes">
                <span t-esc="', '.join(map(lambda x: str(x.amount)+'%', line.taxes_id))"/>
            </td>
        </xpath>

        <xpath expr="//p[@t-field='o.notes']" position="replace">
            <div class="note" style="font-size:10px !important">
                <p t-field="o.notes"/>
            </div>
        </xpath>

    </template>
</odoo>